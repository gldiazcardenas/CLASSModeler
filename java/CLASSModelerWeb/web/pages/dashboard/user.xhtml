<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">

<!-- Change password dialog -->
<p:dialog id="changePasswordDialog" widgetVar="dlgChangePassword" header="#{msgs.CHANGE_PASSWORD_FORM_TITLE}" width="400" closable="true" closeOnEscape="true" modal="true" rendered="#{sessionController.registeredUser}" appendToBody="true">
    <h:form id="changePasswordForm">
        <h:panelGrid columns="1" width="100%">
            <p:password id="oldPassword" value="#{changePasswordController.oldPassword}" style="width: 97%" required="true">
                <f:validator binding="#{changePasswordValidator}"/>
            </p:password>
            <p:watermark for="oldPassword" value="#{msgs.CHANGE_PASSWORD_FORM_OLD_PASSWORD_FIELD}"/>
            
            <p:password id="newPassword" value="#{changePasswordController.newPassword}" required="true" binding="#{newPassword}" style="width: 97%"/>
            <p:watermark for="newPassword" value="#{msgs.CHANGE_PASSWORD_FORM_NEW_PASSWORD_FIELD}"/>
            
            <p:password id="newConfirmation" value="#{changePasswordController.newConfirmation}" required="true" style="width: 97%">
                <f:attribute name="attrNewPassword" value="#{newPassword.value}" />
                <f:validator binding="#{changePasswordValidator}"/>
            </p:password>
            <p:watermark for="newConfirmation" value="#{msgs.CHANGE_PASSWORD_FORM_NEW_CONFIRM_FIELD}"/>
            
            <p:messages for="changePasswordMessage" />
            
            <p:separator />
            
            <h:panelGrid columns="3">
                <p:commandButton id="btSaveChangePassword" value="#{msgs.SAVE_LABEL}" actionListener="#{changePasswordController.processAJAX()}"
                                 update=":changePasswordForm, :generalMessage"
                                 onclick="jQuery(this).addClass('ui-state-disabled'); jQuery(this).attr('disabled', 'disabled');"
                                 oncomplete="responseChangePassword(xhr, status, args)" />
                
                <p:commandButton value="#{msgs.CANCEL_LABEL}" type="button" onclick="dlgChangePassword.hide()" />
                
                <p:ajaxStatus style="width: 16px; height: 16px;">
                    <f:facet name="start"><h:graphicImage name="loading.gif" library="images" /></f:facet>
                    <f:facet name="complete"><h:outputText value="" /></f:facet>
                </p:ajaxStatus>
            </h:panelGrid>
        </h:panelGrid>
    </h:form>
    
    <!-- Callback function that hides the dialog -->
    <script type="text/javascript">
      function responseChangePassword(xhr, status, args) {
        if (!args.validationFailed) {
          dlgChangePassword.hide();
        }
      }
    </script>
</p:dialog>

<!-- Edit Profile Dialog -->
<p:dialog id="profileDialog" widgetVar="dlgProfile" width="550" header="#{msgs.USER_PROFILE_FORM_TITLE}" modal="true" closable="true" closeOnEscape="true" rendered="#{sessionController.registeredUser}">
    <h:form id="profileForm">
        <table style="width: 100%;">
            <tr>
                <td width="30%" align="center" style="border-bottom: none; border-top: none; border-left: none;" class="ui-widget-content">
                    <p:graphicImage id="avatar" url="#{userProfileController.avatar}" width="128" height="128" style="display: block; margin-bottom: 5px;" />
                    <p:commandButton value="#{msgs.USER_PROFILE_DEFAULT_AVATAR_LABEL}" actionListener="#{userProfileController.setDefaultAvatar()}" update=":profileForm:avatar" icon="ui-icon-image" />
                </td>
                <td width="70%">
                    <h:panelGrid columns="1" width="100%">
                        <p:inputText id="firstName" value="#{userProfileController.firstName}" style="width: 99%;" />
                        <p:watermark for="firstName" value="#{msgs.SIGN_UP_FORM_FIRST_NAME_FIELD}" />
                        
                        <p:inputText id="lastName" value="#{userProfileController.lastName}" style="width: 99%;" />
                        <p:watermark for="lastName" value="#{msgs.SIGN_UP_FORM_LAST_NAME_FIELD}" />
                        
                        <p:calendar id="birthdate" value="#{userProfileController.birthdate}" navigator="true" showOn="both" />
                        <p:watermark for="birthdate" value="#{msgs.SIGN_UP_FORM_DATEOFBIRTH_FIELD}" />
                        
                        <p:selectOneRadio id="gender" value="#{userProfileController.gender}" converter="genderConverter" required="true">
                            <f:selectItems value="#{userProfileController.gendersForSelectOneRadio}" />
                        </p:selectOneRadio>
                        
                        <p:fileUpload auto="true"
                                      mode="advanced"
                                      update=":profileForm:avatar, :profileForm:profileMessage" 
                                      fileUploadListener="#{userProfileController.handleFileUpload}"
                                      allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                                      sizeLimit="1050000"
                                      invalidSizeMessage="#{msgs.INVALID_FILE_SIZE_MESSAGE}"
                                      invalidFileMessage="#{msgs.INVALID_FILE_TYPE_MESSAGE}"
                                      label="#{msgs.USER_PROFILE_CHANGE_AVATAR_LABEL}" />
                        
                        <p:messages id="profileMessage" for="userProfileMessage" />
                        
                        <p:separator />
                        
                        <h:panelGrid columns="3">
                            <p:commandButton value="#{msgs.SAVE_LABEL}" actionListener="#{userProfileController.processAJAX()}"
                                             update=":profileForm, :generalMessage, :userForm"
                                             onclick="jQuery(this).addClass('ui-state-disabled'); jQuery(this).attr('disabled', 'disabled');"
                                             oncomplete="responseProfile(xhr, status, args)" />
                            
                            <p:commandButton value="#{msgs.CANCEL_LABEL}" type="button" onclick="dlgProfile.hide()" />
                            
                            <p:ajaxStatus style="width: 16px; height: 16px;">
                                <f:facet name="start"><h:graphicImage name="loading.gif" library="images" /></f:facet>
                                <f:facet name="complete"><h:outputText value="" /></f:facet>
                            </p:ajaxStatus>
                        </h:panelGrid>
                    </h:panelGrid>
                </td>
            </tr>
        </table>
    </h:form>
    
    <!-- Callback function that hides the dialog -->
    <script type="text/javascript">
      function responseProfile(xhr, status, args) {
        if (!args.validationFailed) {
          dlgProfile.hide();
        }
      }
    </script>
</p:dialog>
    
</ui:composition>