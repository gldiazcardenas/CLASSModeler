<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui">

<p:dialog id="shareDialog" header="#{diagramController.title}" widgetVar="dlgShare" closable="true" closeOnEscape="true" modal="true" width="600">
    <h:form id="shareForm">
        <h:outputText value="#{msgs.SHARE_FORM_USER_LIST_LABEL}" styleClass="italic, bold" />
        <p:dataTable id="usersTable"
                     value="#{diagramController.availableUsers}"
                     var="user"
                     rowKey="#{user.key}"
                     selection="#{diagramController.selectedUsers}"
                     emptyMessage="#{msgs.EMPTY_TABLE_MESSAGE}"
                     paginator="true"
                     paginatorPosition="bottom"
                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     rowsPerPageTemplate="10, 20, 30"
                     rows="20">
            
            <p:column selectionMode="multiple" style="width:2%" disabledSelection="#{!formatController.isActivatedAccount(user.accountStatus)}" />
            
            <p:column headerText="#{msgs.COLUMN_USER_NAME_LABEL}" sortBy="#{user.name}" disabledSelection="#{!formatController.isActivatedAccount(user.accountStatus)}">
                <h:outputText value="#{user.name}" />
            </p:column>
            
            <p:column headerText="#{msgs.COLUMN_USER_ACCOUNT_STATUS_LABEL}" sortBy="#{user.accountStatus}" style="width: 50px; text-align: center; padding-top: 1px; padding-bottom: 1px;">
                <h:graphicImage url="#{formatController.getUserAccountStatusImage(user.accountStatus)}" title="#{formatController.getUserAccountStatusName(user.accountStatus)}" />
            </p:column>
        </p:dataTable>
        
        <br/>
        <h:outputText value="#{msgs.SHARE_FORM_PRIVILEGE_LABEL}" styleClass="italic, bold" />
        <p:selectBooleanCheckbox value="#{diagramController.writeable}" />
        
        <p class="justify" style="margin-top: 25px;">
            <h:outputText value="#{msgs.NOTE_LABEL}: " styleClass="bold" />
            <h:outputText value="#{msgs.SHARE_FORM_USER_ACCOUNT_STATUS_MESSAGE}" />
        </p>
        
        <p:messages for="shareDialogMessage" />
        
        <p:separator/>
        
        <h:panelGrid columns="3">
            <p:commandButton id="btSaveSharingDiagram" value="#{msgs.SAVE_LABEL}" actionListener="#{diagramController.processAJAX()}"
                             onclick="jQuery(this).addClass('ui-state-disabled'); jQuery(this).attr('disabled', 'disabled');"
                             update=":shareForm, :generalMessage"
                             oncomplete="responseShareDiagram(xhr, status, args)"/>
            
            <p:commandButton value="#{msgs.CANCEL_LABEL}" type="button" onclick="dlgShare.hide()" />
            
            <p:ajaxStatus style="width: 16px; height: 16px;">
                <f:facet name="start"><h:graphicImage name="loading.gif" library="images" /></f:facet>
                <f:facet name="complete"><h:outputText value="" /></f:facet>
            </p:ajaxStatus>
        </h:panelGrid>
    </h:form>
    
    <!-- Callback function that hides the dialog -->
    <script type="text/javascript">
      function responseShareDiagram(xhr, status, args) {
        if (!args.validationFailed) {
          dlgShare.hide();
        }
      }
    </script>
</p:dialog>

</ui:composition>